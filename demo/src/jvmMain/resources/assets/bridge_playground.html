<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ComposeWebView Bridge Playground</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #0b1020;
      --panel: #121a33;
      --text: #e8ecff;
      --muted: #aab2d5;
      --border: rgba(255, 255, 255, 0.08);
      --accent: #7aa2ff;
      --danger: #ff6b6b;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background: radial-gradient(1000px 600px at 20% 0%, rgba(122, 162, 255, 0.25), transparent 55%),
                  radial-gradient(900px 500px at 90% 20%, rgba(140, 255, 201, 0.12), transparent 60%),
                  var(--bg);
      color: var(--text);
    }

    header {
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      background: rgba(18, 26, 51, 0.8);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
    }

    header h1 {
      margin: 0;
      font-size: 16px;
      letter-spacing: 0.2px;
    }

    header p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    main {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 14px;
      padding: 14px;
    }

    .card {
      border: 1px solid var(--border);
      background: rgba(18, 26, 51, 0.7);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 16px 50px rgba(0,0,0,0.35);
    }

    .row {
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }

    label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input, textarea {
      width: 100%;
      border: 1px solid var(--border);
      background: rgba(11, 16, 32, 0.7);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      outline: none;
      box-sizing: border-box;
    }

    textarea { min-height: 92px; resize: vertical; }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    button {
      border: 1px solid var(--border);
      background: rgba(11, 16, 32, 0.55);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      font-weight: 600;
      letter-spacing: 0.15px;
    }

    button:hover { background: rgba(11, 16, 32, 0.75); border-color: rgba(122, 162, 255, 0.35); }
    button:active { transform: translateY(1px); }
    button.danger:hover { border-color: rgba(255, 107, 107, 0.45); }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid var(--border);
      background: rgba(11, 16, 32, 0.35);
      color: var(--muted);
      margin-top: 8px;
    }

    .pill b { color: var(--text); }

    pre {
      margin: 0;
      padding: 12px;
      background: rgba(11, 16, 32, 0.65);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: auto;
      max-height: 420px;
      line-height: 1.35;
      font-size: 12px;
      color: #d9e1ff;
    }

    .hint {
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    a { color: var(--accent); }

    @media (max-width: 900px) {
      main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<header>
  <h1>Bridge Playground (JS ↔ Kotlin)</h1>
  <p>
    This page calls <code>window.kmpJsBridge.callNative(...)</code>. The Desktop/Wry backend routes messages via
    <code>window.ipc.postMessage</code>.
  </p>
  <div id="status" class="pill"><b>Status:</b> <span>waiting for bridge…</span></div>
</header>

<main>
  <section class="card">
    <div class="row">
      <div>
        <label for="echoInput">Echo payload</label>
        <input id="echoInput" value="Hello from JS" />
      </div>
      <div>
        <label for="urlInput">Target URL (for navigate / cookies)</label>
        <input id="urlInput" value="https://httpbin.org/cookies" />
      </div>
      <div>
        <label for="cookieName">Cookie name / value</label>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <input id="cookieName" value="demo_cookie" />
          <input id="cookieValue" value="from_js" />
        </div>
      </div>
      <div>
        <label for="customParams">Custom params (JSON)</label>
        <textarea id="customParams">{ "note": "You can send any JSON object as params" }</textarea>
      </div>
    </div>

    <div class="buttons">
      <button id="btnEcho">callNative('echo', …) + callback</button>
      <button id="btnAppInfo">callNative('appInfo', …) + callback</button>
      <button id="btnNavigate">callNative('navigate', …) (no callback)</button>
      <button id="btnSetCookie">callNative('setCookie', …) + callback</button>
      <button id="btnGetCookies">callNative('getCookies', …) + callback</button>
      <button id="btnCustom">callNative('custom', …) + callback</button>
      <button id="btnConsole" class="danger">console.log / console.error</button>
    </div>

    <p class="hint">
      If the bridge is not ready, load may still be finishing. The Kotlin side injects the bridge once
      <code>LoadingState.Finished</code>.
    </p>
  </section>

  <aside class="card">
    <label>Event log</label>
    <pre id="log"></pre>
  </aside>
</main>

<script>
  const logEl = document.getElementById('log');
  const statusEl = document.getElementById('status').querySelector('span');

  function log(line) {
    const time = new Date().toISOString().split('T')[1].replace('Z', '');
    logEl.textContent = `[${time}] ${line}\n` + logEl.textContent;
  }

  function hasBridge() {
    return window.kmpJsBridge && typeof window.kmpJsBridge.callNative === 'function';
  }

  function updateStatus() {
    statusEl.textContent = hasBridge() ? 'ready' : 'waiting for bridge…';
  }

  updateStatus();
  setInterval(updateStatus, 400);

  function call(methodName, params, withCallback) {
    if (!hasBridge()) {
      log('Bridge not ready yet');
      return;
    }

    log(`→ ${methodName} params=${JSON.stringify(params)}`);
    window.kmpJsBridge.callNative(
      methodName,
      params,
      withCallback ? function (data) { log(`← ${methodName} callback=${data}`); } : null
    );
  }

  document.getElementById('btnEcho').addEventListener('click', () => {
    call('echo', { text: document.getElementById('echoInput').value }, true);
  });

  document.getElementById('btnAppInfo').addEventListener('click', () => {
    call('appInfo', { requestedAt: Date.now() }, true);
  });

  document.getElementById('btnNavigate').addEventListener('click', () => {
    call('navigate', { url: document.getElementById('urlInput').value }, false);
  });

  document.getElementById('btnSetCookie').addEventListener('click', () => {
    call('setCookie', {
      url: document.getElementById('urlInput').value,
      name: document.getElementById('cookieName').value,
      value: document.getElementById('cookieValue').value
    }, true);
  });

  document.getElementById('btnGetCookies').addEventListener('click', () => {
    call('getCookies', { url: document.getElementById('urlInput').value }, true);
  });

  document.getElementById('btnCustom').addEventListener('click', () => {
    let obj = {};
    try { obj = JSON.parse(document.getElementById('customParams').value || '{}'); }
    catch (e) { obj = { parseError: String(e) }; }
    call('custom', obj, true);
  });

  document.getElementById('btnConsole').addEventListener('click', () => {
    console.log('console.log from bridge_playground.html');
    console.error('console.error from bridge_playground.html');
    log('Wrote console.log + console.error');
  });
</script>
</body>
</html>
